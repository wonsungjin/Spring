package com.lec05.rest;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
@Service
public class BoardServiceImpl implements BoardService {
	@Autowired
	private BoardDAO boardDAO;
	
	public int svcBoardInsert(@ModelAttribute BoardVO bvo) {
		int insertRows = boardDAO.boardInsert(bvo);
		return insertRows;						//   /board_list
	}
	
	public Map svcBoardList(){
		ArrayList<BoardVO> list = boardDAO.boardSelect();
		model.addAttribute("KEY_BOARDLIST", list);
		Map<String,Object> map =new HashMap<String,Object>();
		return map;     				//   /  lec05_board/board_list  .jsp  
	}
	
	public String ctlBoardDetail(Model model, @RequestParam("seq") int seq){
		//------------------------------------------------------
		//상세만 가져가고 ,댓글목록은 (REST)로 출력
		//	트랜잭션 : SELECT(게시물상세) , SELECT(댓글목록) 
		//	게시물상세 EL : ${KEY_BOARDVO} () 
		//	댓글목록 EL  : ${KEY_REPLYLIST}
		//------------------------------------------------------
		BoardVO bvo = boardDAO.boardSelectOne(seq);
		model.addAttribute("KEY_BOARDVO", bvo);
		//ArrayList<ReplyVO> rlist = boardDAO.replySelect(seq);
		//model.addAttribute("KEY_REPLYLIST", rlist);
		
		
		return "lec05_board/board_detail";						//   /   lec05_board/board_detail  .jsp
	}
	
	
	

	//댓글목록 : REST
	@ResponseBody 
	public ResponseEntity<ArrayList<ReplyVO>> ctlReplyListForRest(Model model
			, @RequestParam("seq") int seq){
		System.out.println(seq);
		
		ArrayList<ReplyVO> rlist = boardDAO.replySelect(seq);
		return new ResponseEntity<>(rlist, HttpStatus.OK);	
	}
	
	//댓글등록 : REST
	@ResponseBody 
	public String ctlReplyInsertForRest(Model model
			, @ModelAttribute ReplyVO rvo){
		System.out.println("입력 "+rvo.getReply());
		
		int res = boardDAO.replyInsert(rvo);
		String msg = "입력에러";
		if(res > 0) {
			msg = "입력성공";
		}
		//return String.valueOf(res);	
		return String.valueOf(msg);
	}
	//댓글삭제 : REST
		@ResponseBody 
		public String ctlReplyDeleteForRest(Model model
				, @ModelAttribute ReplyVO rvo){
			System.out.println("삭제 "+rvo.getRseq());
			
			int res = boardDAO.replyDelete(rvo.getRseq());
			String msg = "입력에러";
			if(res > 0) {
				msg = "입력성공";
			}
			//return String.valueOf(res);	
			return String.valueOf(msg);
		}
	//댓글목록 : REST
	@ResponseBody 
	public ResponseEntity<ArrayList<BoardVO>> ctlReplyListForRest(Model model
			, @RequestParam("search_str") String str){
		System.out.println(str);
		
		ArrayList<BoardVO> rlist = boardDAO.boardSelectBySearch(str);
		return new ResponseEntity<>(rlist, HttpStatus.OK);	
	}


}
