package com.lec05.rest;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.HashMap;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.google.gson.Gson;
import com.lec05.board.BoardDAO;
import com.lec05.board.BoardVO;
import java.util.stream.Collectors;;

/**
 * Servlet implementation class RestServletTest
 */
public class RestServletTest extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public RestServletTest() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
    Gson gson = new Gson();
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		String ename = request.getParameter("content");
		System.out.println(ename);
		
		BoardDAO dao = new BoardDAO();
		ArrayList<BoardVO> list = dao.boardSelect();
		String gsonString = gson.toJson(list);    //"[ {"title":"aaa" , "regid":"kim"}, {"title":"bbb" , "regid":"hong"} ]"
		System.out.println(gsonString + "," + gsonString.getClass());
		PrintWriter out = response.getWriter();
		out.print(gsonString);
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
//		response.setContentType("application/json;charset=UTF-8");
//		String jsonStr = request.getReader().lines().collect(Collectors.joining());
//		System.out.println(jsonStr + "," + jsonStr.getClass());
//		PrintWriter out = response.getWriter();
//		out.print(jsonStr);
		//#####################################################################

//				// 3번째 테스트 STRING - JSON
//
//				response.setContentType("application/json;charset=UTF-8");  //★★★★★★★★
//
//				
//
//				String ename = request.getParameter("ename");
//
//				System.out.println(ename);
//
//				PrintWriter out = response.getWriter();
//
//				Gson gson = new Gson();
//
//				
//
//				//---------- 응답Str : ArrayList<VO>
//
//				BoardDAO dao = new BoardDAO();
//
//				ArrayList<BoardVO> list = dao.boardSelect();
//
//				//객체 리스트[VO]      --> [ {"title"="aaa" , "regid"="kim"}]
//
//				String  listString = gson.toJson(list);
//
//				//스트링 리스트[JSON]  --> "  [ {"title":"aaa" , "regid":"kim"}]  "
//
//				out.println(list);
		//#####################################################################
				// 4번째 테스트 JSON - JSON
				response.setContentType("application/json;charset=UTF-8");  //★★★★★★★★
				
				String jsonStr = request.getReader().lines().collect(Collectors.joining());
				System.out.println(jsonStr + "," + jsonStr.getClass());
				Gson gson = new Gson();
				BoardVO bvo = gson.fromJson(jsonStr, BoardVO.class);
				System.out.println(bvo.getTitle());
				
				PrintWriter out = response.getWriter();
				
				//---------- 응답Str : ArrayList<VO>
				BoardDAO dao = new BoardDAO();
				ArrayList<BoardVO> list = dao.boardSelect();
				//객체 리스트[VO]      --> [ {"title"="aaa" , "regid"="kim"} ]
				String  listString = gson.toJson(list);
				//스트링 리스트[JSON]  --> "  [ {"title":"aaa" , "regid":"kim"} ]  "
				out.println(listString);
	}

}
